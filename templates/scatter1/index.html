<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>People in Custody at Dept. of Correction Facilities: Detained or Sentenced</title>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.min.js"></script>

    </head>
    <body>


<canvas id="chart" width=auto max-height="400"></canvas>
<script>

Chart.defaults.global.responsive = true
Chart.defaults.global.tooltips.backgroundColor="grey"
Chart.defaults.global.maintainAspectRatio = true
Chart.defaults.global.legend = false


chartIt();

async function chartIt() {
  const data = await getData();
  const ctx = document.getElementById('chart').getContext('2d');
  const myChart = new Chart(ctx, {
    type: 'line',
    fill: false,
    data: {
        labels: data.xs,
        datasets: [
            {
              label: "Median Income",
              data: data.xs
            },
            {
              label: "COVID19 Death",
              data: data.ys
            }
          ]
        },
    options: {

      tooltips: {
        callbacks: {
          label: function(tooltipItem, data) {
            var datasetLabel = data.datasets[tooltipItem.datasetIndex].label || '';
            return datasetLabel + ': '+'' +data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index].toLocaleString('en-US') + ' People';
          }
        }
      },
      scales: {
        yAxes: [{
          stacked: false,
          scaleLabel:{
            display: true,
            labelString: 'People'
          },
          ticks: {
            beginAtZero:false,
            callback: function(value) {
              return '' + value.toLocaleString('en-US');
            }
          }
        }]
      }
    }
  });
  //SPLITTING AND BRINGING IN CSV DATA
  async function getData() {
    const xs = [];
    const ys = [];

    const response = await fetch('Covid_All.csv');
    const data = await response.text();

    const table = data.split('\n').slice(1);
    table.forEach(row => {
      const columns = row.split(',');
      const income = columns[4];
      xs.push(income);
      const covid_death = columns[10];
      ys.push(parseFloat(covid_death)); //make data from string to number and added mean payers of 14 degrees
      console.log(income, covid_death);
    });
    return { xs, ys };
  }

</script>
    </body>
</html>
